<html>

<head>
    <style>
        pre {
            background: #1e1e1e;
            padding: 15px;
            color: #dfdfdf;
        }

        .comment {
            color: #688e49;
        }

        .for {
            color: #b680ba;
        }

        .in {
            color: #5b94cf;
        }

        .array {
            font: bold;
        }

        .array-bracket {
            font-family: sans-serif;
            font-size: 4em;
        }

        .array-name {
            font-family: sans-serif;
            font-size: 1.5em;
        }

        .active-line {
            background: #8e8f32;
            color: #ddd;
        }
    </style>
</head>

<body>


    <p>
        <pre>
<span id="line0"><span class='comment'>#Initialize weights and biases</span></span>
<span id="line1"><span class='input_weights_U'>input_weights_U</span> = np.random.randn(hidden_size, vocab_size) * 0.01</span>
<span id="line2"><span class='input_weights_W'>hidden_weights_W</span> = np.random.randn(hidden_size, hidden_size) * 0.01</span>
<span id="line3"><span class='hidden_bias'>hidden_bias</span>= np.zeros((hidden_size, 1)) # hidden bias</span>
<span id="line4"><span class='output_weights_V'>output_weights_V</span> = np.random.randn(vocab_size, hidden_size) * 0.01    # hidden to output</span>
<span id="line5"><span class='output_bias'>output_bias</span> = np.zeros((vocab_size, 1)) # output bias</span>
<span id="line6"><span class='comment'>#Forward pass</span></span>
<span id="line7">xs, hidden_states, outputs, probabilities = {}, {}, {}, {}</span>
<span id="line8"><span class='loss'>loss</span> = 0</span>
<span id="line9">hidden_states[-1] = np.copy(hidden_state_prev)</span>
<span id="line10"><span class="for">for</span> t <span class="in">in</span> range(len(inputs)): </span>
    <span id="line11"><span class="comment"># one-hot-encoding the input character</span> </span>
    <span id="line12"><span class='xs'>xs[t]</span> = np.zeros((vocab_size,1))  </span>
    <span id="line13"><span class='character'>character</span> = inputs[t]</span>
    <span id="line14"><span class='xs'>xs[t]</span>[character] = 1 </span>
    <span id="line15"><span class='target'>target</span> = targets[t]</span>
    <span id="line16"><span class="comment"># Compute hidden state </span></span>
    <span id="line17"><span class='hidden_state'>hidden_states[t]</span> = np.tanh(<span class='input_weights_U'>input_weights_U</span> @ <span class='xs'>xs[t]</span> + <span class='hidden_weights_W'>hidden_weights_W</span> @ hidden_states[t-1] + <span class='hidden_bias'>hidden_bias</span>) </span>
    <span id="line18"><span class="comment"># Compute output and probabilities</span></span>
    <span id="line19"><span class='outputs'>outputs[t]</span> = <span class='output_weights_v'>output_weights_V</span> @ <span class="hidden_state">hidden_states[t]</span> + <span class='output_bias'>output_bias</span></span>
    <span id="line20"><span class='probabilities'>probabilities[t]</span> = np.exp(<span class='outputs'>outputs[t]</span>) / np.sum(np.exp(<span class='outputs'>outputs[t]</span>))</span>
    <span id="line21"><span class="comment">#Compute cross-entropy loss</span></span>
    <span id="line22"><span class='loss'>loss</span> += -np.log(<span class='probabilities'>probabilities[t]</span>[<span class='target'>target</span>,0]) </span></pre>
    </p>

    <button onclick="goBack()">Back</button>
    <button onclick="goFoward()">Forward</button>
    <br />

    <svg width=1500 height=600>
    </svg>


    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript">

        var state = -1
        function goBack() {
            state = state - 1;
            goState(state, false)
        }

        function goFoward() {
            state = state + 1;
            goState(state, true)
        }

        function goState0(doTransition) {
            let fadeIn = doTransition
            placeRNNBlock(50, 100, fadeIn)

            var U = [[0.04967142, 0.06476885, -0.02341534], [-0.01382643, 0.15230299, -0.0234137]]
            placeTensor("U", "U", 150, 185, U, fadeIn);
        }

        function goState1(doTransition) {
            goState0(false);
            let fadeIn = doTransition

            var W = [[0.15792128, 0.054256, 0.02419623],
            [0.07674347, -0.04634177, -0.19132802],
            [-0.04694744, -0.04657298, -0.17249178]]
            placeTensor("W", "W", 35, 100, W, fadeIn);
        }

        function goState2(doTransition) {
            goState1(false);
            let fadeIn = doTransition;

            var hidden_bias = [[0.00, 0.00, 0.00]]
            placeTensor("", "hidden_bias", 35, 65, hidden_bias, fadeIn);
        }

        function goState3(doTransition) {
            goState2(false);
            let fadeIn = doTransition;

            var output_weights = [[-0.05622875, -0.09080241],
            [-0.10128311, -0.14123037],
            [0.03142473, 0.14656488]]

            placeTensor_2Elements("V", "V", 150, 60, output_weights, fadeIn);
        }

        function goState4(doTransition) {
            goState3(false);
            let fadeIn = doTransition

            var output_bias = [[0, 0]]
            placeTensor_2Elements("", "output_bias", 220, 60, output_bias, fadeIn);
        }

        function goState5(doTransition) {
            goState4(false);
        }

        function goState6(doTransition) {
            goState5(false);
            let fadeIn = doTransition;

            placeText("loss", "loss", "0", 0, 20, fadeIn);
        }

        function goState7(doTransition) {
            goState6(false);
            let fadeIn = doTransition;

            var hidden_state_prev = [[0.0, 0.0, 0.0]]
            placeTensor("", "h", 0, 125, hidden_state_prev, fadeIn);
        }

        function goState8(doTransition) {
            goState7(false);
        }

        function goState9(doTransition) {
            goState8(false);
            let fadeIn = doTransition;

            let input_tensor = [[0.0, 0.0]];
            placeTensor_2Elements("x", "x", 118, 225, input_tensor, fadeIn);
        }

        function goState10(doTransition) {
            goState9(false);
            let fadeIn = doTransition;

            placeText("character", "character_0", "1", 260, 535, fadeIn);
        }

        function goState11(doTransition) {
            goState10(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#x').remove();
            let input_tensor = [[0.0, 1.0]];
            placeTensor_2Elements("x", "x", 118, 225, input_tensor, fadeIn, contentsChanged);
        }

        function goState12(doTransition) {
            goState11(false);
            let fadeIn = doTransition;

            placeText("target", "target_0", "0", 270, 15, fadeIn);
        }

        function goState13(doTransition) {
            goState12(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let hidden_state = [[0.0496306, 0.06467844, -0.02341106]];
            placeTensor("", "hidden_state", 118, 120, hidden_state, fadeIn, contentsChanged);
        }

        function goState14(doTransition) {
            goState13(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let outputs = [[-0.01007719, -0.01707238]];
            placeTensor_2Elements("o", "o", 95, 15, outputs, fadeIn, contentsChanged);
        }

        function goState15(doTransition) {
            goState14(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let probabilities = [[0.50174879, 0.49825121]]
            placeTensor_2Elements("p", "p", 145, 15, probabilities, fadeIn, contentsChanged);
        }

        function goState16(doTransition) {
            goState15(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#loss').remove();
            placeText("loss", "loss", "0.69665", 0, 20, fadeIn, contentsChanged);
        }

        function goState17(doTransition) {
            goState16(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            placeRNNBlock(275, 100, fadeIn);

            if (doTransition) {
                d3.select('#W').transition().attr('x', 300).attr('y', 55);
                d3.select('#V').transition().attr('x', 375);
                d3.select('#U').transition().attr('x', 375);
                d3.select('#hidden_bias').transition().attr('x', 380).attr('y', 25);
                d3.select('#output_bias').transition().attr('x', 445);
            }
            else {
                d3.select('#W').attr('x', 300).attr('y', 55);
                d3.select('#V').attr('x', 375);
                d3.select('#U').attr('x', 375);
                d3.select('#hidden_bias').attr('x', 380).attr('y', 25);
                d3.select('#output_bias').attr('x', 445);
            }

            d3.select("#o").remove();
            d3.select("#p").remove();
            d3.select("#x").remove();
            d3.select("#h").remove();
        }

        function goState18(doTransition) {
            goState17(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let input_tensor = [[0.0, 0.0]];
            placeTensor_2Elements("x", "x", 230, 225, input_tensor, fadeIn);
        }

        function goState19(doTransition) {
            goState18(false);
            let fadeIn = doTransition;

            placeText("character", "character_1", "0", 480, 535, fadeIn);
        }

        function goState20(doTransition) {
            goState19(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#x').remove();
            let input_tensor = [[1.0, 0.0]];
            placeTensor_2Elements("x", "x", 230, 225, input_tensor, fadeIn, contentsChanged);
        }

        function goState21(doTransition) {
            goState20(false);
            let fadeIn = doTransition;

            placeText("target", "target_1", "1", 480, 15, fadeIn);
        }

        function goState22(doTransition) {
            goState21(false);

            let fadeIn = doTransition;
            let contentsChanged = false;

            let hidden_state = [[7.40357596e-05, 1.51903922e-01, -3.05399045e-02]]
            placeTensor("", "hidden_state", 230, 120, hidden_state, fadeIn, contentsChanged);
        }

        function goState23(doTransition) {
            goState22(false);

            let fadeIn = doTransition;
            let contentsChanged = false;

            let outputs = [[-0.01634917, -0.02593625]];
            placeTensor_2Elements("o", "o", 215, 10, outputs, fadeIn, contentsChanged);
        }

        function goState24(doTransition) {
            goState23(false);

            let fadeIn = doTransition;
            let contentsChanged = false;
            let probabilities = [[0.50239675, 0.49760325]]
            placeTensor_2Elements("p", "p", 260, 10, probabilities, fadeIn, contentsChanged);
        }

        function goState25(doTransition) {
            goState24(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#loss').remove();
            placeText("loss", "loss", "1.38501", 0, 20, fadeIn, contentsChanged);
        }

        function goState26(doTransition) {
            goState25(false);

            let fadeIn = doTransition;

            placeRNNBlock(500, 100, fadeIn);

            if (doTransition) {
                d3.select('#W').transition().attr('x', 535).attr('y', 55);
                d3.select('#V').transition().attr('x', 605);
                d3.select('#U').transition().attr('x', 605);
                d3.select('#hidden_bias').transition().attr('x', 615).attr('y', 25);
                d3.select('#output_bias').transition().attr('x', 675);
            }
            else {
                d3.select('#W').attr('x', 535).attr('y', 55);
                d3.select('#V').attr('x', 605);
                d3.select('#U').attr('x', 605);
                d3.select('#hidden_bias').attr('x', 615).attr('y', 25);
                d3.select('#output_bias').attr('x', 675);
            }

            d3.select("#o").remove();
            d3.select("#p").remove();
            d3.select("#x").remove();
            d3.select("#h").remove();
        }

        function goState27(doTransition) {
            goState26(false);

            let fadeIn = doTransition;
            let contentsChanged = false;

            let input_tensor = [[0.0, 0.0]];
            placeTensor_2Elements("x", "x", 343, 225, input_tensor, fadeIn);
        }

        function goState28(doTransition) {
            goState27(false);

            let fadeIn = doTransition;
            placeText("character", "character_2", "1", 700, 535, fadeIn);
        }

        function goState29(doTransition) {
            goState28(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#x').remove();
            let input_tensor = [[0.0, 1.0]];
            placeTensor_2Elements("x", "x", 343, 225, input_tensor, fadeIn, contentsChanged);
        }

        function goState30(doTransition) {
            goState29(false);
            let fadeIn = doTransition;

            placeText("target", "target_2", "1", 700, 15, fadeIn);
        }

        function goState31(doTransition) {
            goState30(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let hidden_state = [[0.06269218, 0.0590868, -0.0471741]]
            placeTensor("", "hidden_state", 343, 120, hidden_state, fadeIn, contentsChanged);
        }

        function goState32(doTransition) {
            goState31(false);

            let fadeIn = doTransition;
            let contentsChanged = false;

            let outputs = [[-0.01099203, -0.02095152]]
            placeTensor_2Elements("o", "o", 330, 10, outputs, fadeIn, contentsChanged);
        }

        function goState33(doTransition) {
            goState32(false);

            let fadeIn = doTransition;
            let contentsChanged = false;
            let probabilities = [[0.50248985, 0.49751015]];
            placeTensor_2Elements("p", "p", 375, 10, probabilities, fadeIn, contentsChanged);
        }

        function goState34(doTransition) {
            goState33(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#loss').remove();
            placeText("loss", "loss", "2.08315", 0, 20, fadeIn, contentsChanged);
        }

        function goState35(doTransition) {
            goState34(false);
            let fadeIn = doTransition;

            placeRNNBlock(725, 100, fadeIn);

            if (doTransition) {
                d3.select('#W').transition().attr('x', 755).attr('y', 55);
                d3.select('#V').transition().attr('x', 835);
                d3.select('#U').transition().attr('x', 835);
                d3.select('#hidden_bias').transition().attr('x', 835).attr('y', 25);
                d3.select('#output_bias').transition().attr('x', 905);
            }
            else {
                d3.select('#W').attr('x', 755).attr('y', 55);
                d3.select('#V').attr('x', 835);
                d3.select('#U').attr('x', 835);
                d3.select('#hidden_bias').attr('x', 835).attr('y', 25);
                d3.select('#output_bias').attr('x', 905);
            }

            d3.select("#o").remove();
            d3.select("#p").remove();
            d3.select("#x").remove();
            d3.select("#h").remove();
        }

        function goState36(doTransition) {
            goState35(false);

            let fadeIn = doTransition;
            let input_tensor = [[0.0, 0.0]];
            placeTensor_2Elements("x", "x", 455, 225, input_tensor, fadeIn);
        }
        
        function goState37(doTransition) {
            goState36(false);
            
            let fadeIn = doTransition;
            placeText("character", "character_2", "0", 935, 535, fadeIn);
        }
        
        function goState38(doTransition) {
            goState37(false);
            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#x').remove();
            let input_tensor = [[1.0, 0.0]];
            placeTensor_2Elements("x", "x", 455, 225, input_tensor, fadeIn, contentsChanged);
        }
        
        function goState39(doTransition) {
            goState38(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            placeText("target", "target_3", "0", 933, 15, fadeIn);
        }
        
        function goState40(doTransition) {
            goState39(false);

            let fadeIn = doTransition;
            let contentsChanged = false;

            let hidden_state = [[ 0.06293721,  0.05884817, -0.04850882]]
            placeTensor("", "hidden_state", 455, 120, hidden_state, fadeIn, contentsChanged);
        }
        
        function goState41(doTransition) {
            goState40(false);

            let fadeIn = doTransition;
            let contentsChanged = false;
            let outputs = [[-0.01102358, -0.02113569]]
            placeTensor_2Elements("o", "o", 440, 10, outputs, fadeIn, contentsChanged);
        }

        function goState42(doTransition) {
            goState41(false);
            let fadeIn = doTransition;
            let contentsChanged = false;

            let probabilities = [[0.502528, 0.497472]]
            placeTensor_2Elements("p", "p", 485, 10, probabilities, fadeIn, contentsChanged);
        }
        
        function goState43(doTransition) {
            goState42(false);

            let fadeIn = false;
            let contentsChanged = doTransition;

            d3.select('#loss').remove();
            placeText("loss", "loss", "2.77402", 0, 20, fadeIn, contentsChanged);
        }

        function goState(state, doTransition) {
            //Clear the svg and but our arrowhead definitions
            d3.select("svg").selectAll("*").remove()
            d3.select("svg").append("defs")
                .append("marker")
                .attr("id", "arrow")
                .attr("markerWidth", 10)
                .attr("markerHeight", 10)
                .attr("refX", 0)
                .attr("refY", 3)
                .attr("orient", "auto")
                .append('path')
                .attr('d', 'M0,0 L0,6 L9,3 z')
                .attr('fill', '#000')

            //Clear active line
            var activeLines = document.getElementsByClassName("active-line");
            for (var i = 0; i < activeLines.length; i++) {
                var currentActiveLine = activeLines[i];
                currentActiveLine.classList.remove('active-line')
            }

            if (state == 0) {
                var activeLine = document.getElementById("line1")
                activeLine.setAttribute('class', 'active-line')
                goState0(doTransition)
            }
            else if (state == 1) {
                var activeLine = document.getElementById("line2")
                activeLine.setAttribute('class', 'active-line')
                goState1(doTransition);
            }
            else if (state == 2) {
                var activeLine = document.getElementById("line3")
                activeLine.setAttribute('class', 'active-line')
                goState2(doTransition);
            }
            else if (state == 3) {
                var activeLine = document.getElementById("line4")
                activeLine.setAttribute('class', 'active-line')
                goState3(doTransition);
            }
            else if (state == 4) {
                var activeLine = document.getElementById("line5")
                activeLine.setAttribute('class', 'active-line')
                goState4(doTransition);
            }
            else if (state == 5) {
                var activeLine = document.getElementById("line7")
                activeLine.setAttribute('class', 'active-line')
                goState5(doTransition);
            }
            else if (state == 6) {
                var activeLine = document.getElementById("line8")
                activeLine.setAttribute('class', 'active-line')
                goState6(doTransition);
            }
            else if (state == 7) {
                var activeLine = document.getElementById("line9")
                activeLine.setAttribute('class', 'active-line')
                goState7(doTransition);
            }
            else if (state == 8) {
                var activeLine = document.getElementById("line10")
                activeLine.setAttribute('class', 'active-line')
                goState8(doTransition);
            }
            else if (state == 9) {
                var activeLine = document.getElementById("line12")
                activeLine.setAttribute('class', 'active-line')
                goState9(doTransition);
            }
            else if (state == 10) {
                var activeLine = document.getElementById("line13")
                activeLine.setAttribute('class', 'active-line')
                goState10(doTransition);
            }
            else if (state == 11) {
                var activeLine = document.getElementById("line14")
                activeLine.setAttribute('class', 'active-line')
                goState11(doTransition);
            }
            else if (state == 12) {
                var activeLine = document.getElementById("line15")
                activeLine.setAttribute('class', 'active-line')
                goState12(doTransition);
            }
            else if (state == 13) {
                var activeLine = document.getElementById("line17")
                activeLine.setAttribute('class', 'active-line')
                goState13(doTransition);
            }
            else if (state == 14) {
                var activeLine = document.getElementById("line19")
                activeLine.setAttribute('class', 'active-line')
                goState14(doTransition);
            }
            else if (state == 15) {
                var activeLine = document.getElementById("line20")
                activeLine.setAttribute('class', 'active-line')
                goState15(doTransition);
            }
            else if (state == 16) {
                var activeLine = document.getElementById("line22")
                activeLine.setAttribute('class', 'active-line')
                goState16(doTransition);
            }
            else if (state == 17) {
                var activeLine = document.getElementById("line10")
                activeLine.setAttribute('class', 'active-line')
                goState17(doTransition);
            }
            else if (state == 18) {
                var activeLine = document.getElementById("line12")
                activeLine.setAttribute('class', 'active-line')
                goState18(doTransition);
            }
            else if (state == 19) {
                var activeLine = document.getElementById("line13")
                activeLine.setAttribute('class', 'active-line')
                goState19(doTransition);
            }
            else if (state == 20) {
                var activeLine = document.getElementById("line14")
                activeLine.setAttribute('class', 'active-line')
                goState20(doTransition);
            }
            else if (state == 21) {
                var activeLine = document.getElementById("line15")
                activeLine.setAttribute('class', 'active-line')
                goState21(doTransition);
            }
            else if (state == 22) {
                var activeLine = document.getElementById("line17")
                activeLine.setAttribute('class', 'active-line')
                goState22(doTransition);
            }
            else if (state == 23) {
                var activeLine = document.getElementById("line19")
                activeLine.setAttribute('class', 'active-line')
                goState23(doTransition);
            }
            else if (state == 24) {
                var activeLine = document.getElementById("line20")
                activeLine.setAttribute('class', 'active-line')
                goState24(doTransition);
            }
            else if (state == 25) {
                var activeLine = document.getElementById("line22")
                activeLine.setAttribute('class', 'active-line')
                goState25(doTransition);
            }
            else if (state == 26) {
                var activeLine = document.getElementById("line10")
                activeLine.setAttribute('class', 'active-line')
                goState26(doTransition);
            }
            else if (state == 27) {
                var activeLine = document.getElementById("line12")
                activeLine.setAttribute('class', 'active-line')
                goState27(doTransition);
            }
            else if (state == 28) {
                var activeLine = document.getElementById("line13")
                activeLine.setAttribute('class', 'active-line')
                goState28(doTransition);
            }
            else if (state == 29) {
                var activeLine = document.getElementById("line14")
                activeLine.setAttribute('class', 'active-line')
                goState29(doTransition);
            }
            else if (state == 30) {
                var activeLine = document.getElementById("line15")
                activeLine.setAttribute('class', 'active-line')
                goState30(doTransition);
            }
            else if (state == 31) {
                var activeLine = document.getElementById("line17")
                activeLine.setAttribute('class', 'active-line')
                goState31(doTransition);
            }
            else if (state == 32) {
                var activeLine = document.getElementById("line19")
                activeLine.setAttribute('class', 'active-line')
                goState32(doTransition);
            }
            else if (state == 33) {
                var activeLine = document.getElementById("line20");
                activeLine.setAttribute('class', 'active-line');
                goState33(doTransition);
            }
            else if (state == 34) {
                var activeLine = document.getElementById("line22");
                activeLine.setAttribute('class', 'active-line');
                goState34(doTransition);
            }
            else if (state == 35) {
                var activeLine = document.getElementById("line10");
                activeLine.setAttribute('class', 'active-line');
                goState35(doTransition);
            }
            else if (state == 36) {
                var activeLine = document.getElementById("line12");
                activeLine.setAttribute('class', 'active-line');
                goState36(doTransition);
            }
            else if (state == 37) {
                var activeLine = document.getElementById("line13");
                activeLine.setAttribute('class', 'active-line');
                goState37(doTransition);
            }
            else if (state == 38) {
                var activeLine = document.getElementById("line14");
                activeLine.setAttribute('class', 'active-line');
                goState38(doTransition);
            }
            else if (state == 39) {
                var activeLine = document.getElementById("line15");
                activeLine.setAttribute('class', 'active-line');
                goState39(doTransition);
            }
            else if (state == 40) {
                var activeLine = document.getElementById("line17");
                activeLine.setAttribute('class', 'active-line');
                goState40(doTransition);
            }
            else if (state == 41) {
                var activeLine = document.getElementById("line19");
                activeLine.setAttribute('class', 'active-line');
                goState41(doTransition);
            }
            else if (state == 42) {
                var activeLine = document.getElementById("line20");
                activeLine.setAttribute('class', 'active-line');
                goState42(doTransition);
            }
            else if (state == 43) {
                var activeLine = document.getElementById("line22");
                activeLine.setAttribute('class', 'active-line');
                goState43(doTransition);
            }

            //Set up hover event listeners

            d3.select('#W')
                .on('mouseover', function() {
                    
                    console.log("");
                });
        }

        function placeText(name, id, value, xOffset, yOffset, fadeIn, contentsChanged) {
            //TODO: Make it look better (font and size)
            var container = d3.select("svg").append("svg")
                .attr('id', id);
            var label = container.append("text")
                .text(name)
                .attr('x', xOffset)
                .attr('y', yOffset);

            //We have to account for the number of characters in our "name" label
            let numberOfCharactersInName = name.length;
            let nameOffset = numberOfCharactersInName * 7;

            var equals = container.append("text")
                .text('=')
                .attr('x', xOffset + nameOffset)
                .attr('y', yOffset);

            var value = container.append("text")
                .text(value)
                .attr('x', xOffset + nameOffset + 12)
                .attr('y', yOffset);

            if (fadeIn) {
                for (let item of [label, equals, value]) {
                    item.attr('opacity', 0)
                        .transition()
                        .attr('opacity', 1)
                }
            }

            if (contentsChanged === true) {
                console.log("Black to red");
                for (let item of [value]) {
                    item.style('fill', 'red')
                }
            }

        }

        function placeRNNBlock(xOffset, yOffset, fadeIn) {
            //Create diagram container
            var diagramContainer = d3.select("svg").append("svg");
            //Draw first hidden-state square
            var rect = diagramContainer.append("rect")
                .attr("x", xOffset + 200)
                .attr("y", yOffset + 125)
                .attr("style", "fill:rgb(255,255,255);stroke-width:3;stroke:rgb(0,0,0)")
                .attr("width", 100).attr("height", 0)
                .attr("height", 100)


            //bottom arrow
            var line = diagramContainer.append("line")
                .attr("x1", xOffset + 250)
                .attr("y1", yOffset + 350)
                .attr("x2", xOffset + 250)
                .attr("y2", yOffset + 250)
                .attr("stroke", "black")
                .attr("stroke-width", "3")
                .attr("marker-end", "url(#arrow)")

            //left arrow
            var leftArrow = diagramContainer.append("line")
                .attr("x1", xOffset + 75)
                .attr("y1", yOffset + 175)
                .attr("x2", xOffset + 175)
                .attr("y2", yOffset + 175)
                .attr("stroke", "black")
                .attr("stroke-width", "3")
                .attr("marker-end", "url(#arrow)")

            //top arrow
            var topArrow = diagramContainer.append("line")
                .attr("x1", xOffset + 250)
                .attr("y1", yOffset + 125)
                .attr("x2", xOffset + 250)
                .attr("y2", yOffset + 40)
                .attr("stroke", "black")
                .attr("stroke-width", "3")
                .attr("marker-end", "url(#arrow)")

            if (fadeIn) {
                for (let item of [rect, line, leftArrow, topArrow]) {
                    item.attr('opacity', 0)
                        .transition()
                        .attr('opacity', 1)
                }
            }
        }

        function placeTensor(name, id, xOffset, yOffset, tensorElements, fadeIn, contentsChanged) {

            var container = d3.select("svg").append('svg')
                .attr('x', xOffset)
                .attr('y', yOffset)
                .attr('id', id)

            var text = container.append('text')
                .attr('x', xOffset + 10)
                .attr('y', yOffset + 45)
                .attr('class', 'array-name')
                .text(name)

            var lb = container.append('text')
                .attr('x', xOffset + 30)
                .attr('y', yOffset + 52)
                .attr('class', 'array-bracket')
                .text('[')

            var numberOfColumns = tensorElements.length;
            var rb = container.append('text')
                .attr('x', xOffset + (numberOfColumns * 40) + 40)
                .attr('y', yOffset + 52)
                .attr('class', 'array-bracket')
                .text(']')

            var elements = container.selectAll('svg').data(tensorElements).enter().append("svg")
                .attr("class", 'array')
                .attr("x", function (d, i, j) { return (i * 40) + 50 + xOffset; })
                .selectAll('text')
                .data(function (d, i, j) { return d; }).enter().append('text')
                .text(function (d, i, j) { return d.toFixed(2); })
                .attr("y", function (d, i, j) {
                    return (i * 20) + 20 + yOffset;
                })

            if (fadeIn === true) {
                for (let item of [text, lb, rb, elements]) {
                    item.attr('opacity', 0)
                        .transition()
                        .attr('opacity', 1)
                }
            }

            if (contentsChanged === true) {
                console.log("Black to red");
                for (let item of [elements]) {
                    item.style('fill', 'red')
                }
            }
        }

        function placeTensor_2Elements(name, id, xOffset, yOffset, tensorElements, fadeIn, contentsChanged) {

            var container = d3.select("svg").append('svg')
                .attr('x', xOffset)
                .attr('y', yOffset)
                .attr('id', id)

            var text = container.append('text')
                .attr('x', xOffset + 10)
                .attr('y', yOffset + 45)
                .attr('class', 'array-name')
                .text(name)

            var lb = container.append('text')
                .attr('x', xOffset + 30)
                .attr('y', yOffset + 52)
                .attr('class', 'array-bracket')
                .text('[')

            var numberOfColumns = tensorElements.length;
            var rb = container.append('text')
                .attr('x', xOffset + (numberOfColumns * 40) + 40)
                .attr('y', yOffset + 52)
                .attr('class', 'array-bracket')
                .text(']')

            var elements = container.selectAll('svg').data(tensorElements).enter().append("svg")
                .attr("class", 'array')
                .attr("x", function (d, i, j) { return (i * 40) + 50 + xOffset; })
                .selectAll('text')
                .data(function (d, i, j) { return d; }).enter().append('text')
                .text(function (d, i, j) { return d.toFixed(2); })
                .attr("y", function (d, i, j) {
                    return (i * 20) + 30 + yOffset;
                })

            if (fadeIn === true) {
                for (let item of [text, lb, rb, elements]) {
                    item.attr('opacity', 0)
                        .transition()
                        .attr('opacity', 1);
                }
            }

            if (contentsChanged === true) {
                console.log("Black to red");
                for (let item of [elements]) {
                    item.style('fill', 'red')
                }
            }
        }

    </script>
</body>

</html>